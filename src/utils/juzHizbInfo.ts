/**
 * Juz and Hizb information based on the standard Madina Mushaf page layout.
 */

// Juz start pages (1-indexed, Madina Mushaf)
const JUZ_START_PAGES: number[] = [
  1, 22, 42, 62, 82, 102, 122, 142, 162, 182,
  202, 222, 242, 262, 282, 302, 322, 342, 362, 382,
  402, 422, 442, 462, 482, 502, 522, 542, 562, 582,
];

// Hizb start pages (60 hizbs)
const HIZB_START_PAGES: number[] = [
  1, 12, 22, 32, 42, 52, 62, 72, 82, 92,
  102, 112, 122, 132, 142, 152, 162, 172, 182, 192,
  202, 212, 222, 232, 242, 252, 262, 272, 282, 292,
  302, 312, 322, 332, 342, 352, 362, 372, 382, 392,
  402, 412, 422, 432, 442, 452, 462, 472, 482, 492,
  502, 512, 522, 532, 542, 552, 562, 572, 582, 592,
];

// Surah names by page range (from page-mapping.json)
const SURAH_PAGE_RANGES: [string, number, number][] = [
  ['الفاتحة', 1, 1], ['البقرة', 2, 49], ['آل عمران', 50, 76],
  ['النساء', 77, 106], ['المائدة', 106, 127], ['الأنعام', 128, 150],
  ['الأعراف', 151, 176], ['الأنفال', 177, 186], ['التوبة', 187, 207],
  ['يونس', 208, 221], ['هود', 221, 235], ['يوسف', 235, 248],
  ['الرعد', 249, 255], ['إبراهيم', 255, 261], ['الحجر', 262, 267],
  ['النحل', 267, 281], ['الإسراء', 282, 293], ['الكهف', 293, 304],
  ['مريم', 305, 312], ['طه', 312, 321], ['الأنبياء', 322, 331],
  ['الحج', 332, 341], ['المؤمنون', 342, 349], ['النور', 350, 359],
  ['الفرقان', 359, 366], ['الشعراء', 367, 376], ['النمل', 377, 385],
  ['القصص', 385, 396], ['العنكبوت', 396, 404], ['الروم', 404, 410],
  ['لقمان', 411, 414], ['السجدة', 415, 417], ['الأحزاب', 418, 427],
  ['سبأ', 428, 434], ['فاطر', 434, 440], ['يس', 440, 445],
  ['الصافات', 446, 452], ['ص', 453, 458], ['الزمر', 458, 467],
  ['غافر', 467, 476], ['فصلت', 477, 482], ['الشورى', 483, 489],
  ['الزخرف', 489, 495], ['الدخان', 496, 498], ['الجاثية', 499, 502],
  ['الأحقاف', 502, 506], ['محمد', 507, 510], ['الفتح', 511, 515],
  ['الحجرات', 515, 517], ['ق', 518, 520], ['الذاريات', 520, 523],
  ['الطور', 523, 525], ['النجم', 526, 528], ['القمر', 528, 531],
  ['الرحمن', 531, 534], ['الواقعة', 534, 537], ['الحديد', 537, 541],
  ['المجادلة', 542, 545], ['الحشر', 545, 549], ['الممتحنة', 549, 551],
  ['الصف', 551, 552], ['الجمعة', 553, 554], ['المنافقون', 554, 556],
  ['التغابن', 556, 558], ['الطلاق', 558, 559], ['التحريم', 560, 561],
  ['الملك', 562, 564], ['القلم', 564, 566], ['الحاقة', 566, 568],
  ['المعارج', 568, 570], ['نوح', 570, 571], ['الجن', 572, 573],
  ['المزمل', 574, 575], ['المدثر', 575, 577], ['القيامة', 577, 578],
  ['الإنسان', 578, 580], ['المرسلات', 580, 581], ['النبأ', 582, 583],
  ['النازعات', 583, 584], ['عبس', 585, 585], ['التكوير', 586, 586],
  ['الانفطار', 587, 587], ['المطففين', 587, 589], ['الانشقاق', 589, 589],
  ['البروج', 590, 590], ['الطارق', 591, 591], ['الأعلى', 591, 591],
  ['الغاشية', 592, 592], ['الفجر', 593, 594], ['البلد', 594, 594],
  ['الشمس', 595, 595], ['الليل', 595, 596], ['الضحى', 596, 596],
  ['الشرح', 596, 596], ['التين', 597, 597], ['العلق', 597, 597],
  ['القدر', 598, 598], ['البينة', 598, 599], ['الزلزلة', 599, 599],
  ['العاديات', 599, 600], ['القارعة', 600, 600], ['التكاثر', 600, 600],
  ['العصر', 601, 601], ['الهمزة', 601, 601], ['الفيل', 601, 601],
  ['قريش', 602, 602], ['الماعون', 602, 602], ['الكوثر', 602, 602],
  ['الكافرون', 603, 603], ['النصر', 603, 603], ['المسد', 603, 603],
  ['الإخلاص', 604, 604], ['الفلق', 604, 604], ['الناس', 604, 604],
];

const ARABIC_NUMBERS = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];

function toArabicNumber(n: number): string {
  return String(n).split('').map(d => ARABIC_NUMBERS[parseInt(d)]).join('');
}

const JUZ_NAMES = [
  'الأول', 'الثاني', 'الثالث', 'الرابع', 'الخامس',
  'السادس', 'السابع', 'الثامن', 'التاسع', 'العاشر',
  'الحادي عشر', 'الثاني عشر', 'الثالث عشر', 'الرابع عشر', 'الخامس عشر',
  'السادس عشر', 'السابع عشر', 'الثامن عشر', 'التاسع عشر', 'العشرون',
  'الحادي والعشرون', 'الثاني والعشرون', 'الثالث والعشرون', 'الرابع والعشرون', 'الخامس والعشرون',
  'السادس والعشرون', 'السابع والعشرون', 'الثامن والعشرون', 'التاسع والعشرون', 'الثلاثون',
];

export interface PageMetadata {
  pageNumber: number;
  pageNumberArabic: string;
  juzNumber: number;
  juzName: string;
  hizbNumber: number;
  hizbNumberArabic: string;
  surahName: string;
}

export function getPageMetadata(pageNumber: number): PageMetadata {
  // Find juz
  let juzNumber = 1;
  for (let i = JUZ_START_PAGES.length - 1; i >= 0; i--) {
    if (pageNumber >= JUZ_START_PAGES[i]) {
      juzNumber = i + 1;
      break;
    }
  }

  // Find hizb
  let hizbNumber = 1;
  for (let i = HIZB_START_PAGES.length - 1; i >= 0; i--) {
    if (pageNumber >= HIZB_START_PAGES[i]) {
      hizbNumber = i + 1;
      break;
    }
  }

  // Find surah (first surah that starts on or before this page)
  let surahName = 'الفاتحة';
  for (const [name, start, end] of SURAH_PAGE_RANGES) {
    if (pageNumber >= start && pageNumber <= end) {
      surahName = name;
      break;
    }
  }

  return {
    pageNumber,
    pageNumberArabic: toArabicNumber(pageNumber),
    juzNumber,
    juzName: `الجزء ${JUZ_NAMES[juzNumber - 1]}`,
    hizbNumber,
    hizbNumberArabic: toArabicNumber(hizbNumber),
    surahName,
  };
}
